# Vercel Deployment Checklist

Use this checklist to ensure your deployment is configured correctly.

## Pre-Deployment

- [ ] Azure Service Principal created
  ```bash
  az ad sp create-for-rbac --name "vercel-ai-agent-demo" --role "Cognitive Services User" --scopes /subscriptions/SUB_ID/resourceGroups/RG_NAME
  ```
- [ ] Service Principal credentials saved:
  - [ ] `AZURE_CLIENT_ID` (appId)
  - [ ] `AZURE_CLIENT_SECRET` (password)
  - [ ] `AZURE_TENANT_ID` (tenant)

- [ ] Azure resource information gathered:
  - [ ] `AZURE_SEARCH_ENDPOINT`
  - [ ] `AZURE_SEARCH_API_KEY`
  - [ ] `FOUNDRY_PROJECT_ENDPOINT`
  - [ ] `AZURE_OPENAI_ENDPOINT`
  - [ ] `AZURE_OPENAI_API_KEY`

## Vercel Configuration

- [ ] Vercel account created
- [ ] Project created in Vercel (via GitHub or CLI)
- [ ] Environment variables added to Vercel dashboard:

### Required Variables
- [ ] `AZURE_AUTH_METHOD=service-principal`
- [ ] `AZURE_TENANT_ID`
- [ ] `AZURE_CLIENT_ID`
- [ ] `AZURE_CLIENT_SECRET`
- [ ] `FOUNDRY_PROJECT_ENDPOINT`
- [ ] `FOUNDRY_API_VERSION=2025-05-01`
- [ ] `AZURE_SEARCH_ENDPOINT`
- [ ] `AZURE_SEARCH_API_KEY`
- [ ] `AZURE_SEARCH_API_VERSION=2025-11-01-preview`
- [ ] `NEXT_PUBLIC_AZURE_OPENAI_ENDPOINT`
- [ ] `AZURE_OPENAI_API_KEY`
- [ ] `NEXT_PUBLIC_SEARCH_ENDPOINT`

### Optional Variables
- [ ] `NEXT_PUBLIC_STANDALONE_AOAI_ENDPOINT`
- [ ] `NEXT_PUBLIC_STANDALONE_AOAI_KEY`

- [ ] All environment variables set for **All Environments** (Production, Preview, Development)

## Deployment

- [ ] Initial deployment completed
- [ ] Build logs checked (no errors)
- [ ] Deployment status: Success

## Post-Deployment Verification

### API Authentication
- [ ] Test Foundry API authentication:
  ```bash
  curl https://YOUR_APP.vercel.app/api/foundry/assistants
  ```
  Expected: JSON response (not 401 error)

- [ ] Check Vercel Function Logs for token refresh:
  - [ ] "Using Service Principal authentication" logged
  - [ ] "Token refreshed, expires at..." logged
  - [ ] No "Invalid bearer token" errors

### Frontend Testing (Incognito Browser)
- [ ] Navigate to `https://YOUR_APP.vercel.app`
- [ ] No authentication prompt appears
- [ ] Knowledge sources page loads
- [ ] Agents page loads
- [ ] Agent Builder accessible
- [ ] Can create a test agent
- [ ] Can send a query to agent
- [ ] Receive response from agent
- [ ] No console errors related to authentication

### Thread & Chat Testing
- [ ] Create new thread
- [ ] Send message to thread
- [ ] Receive assistant response
- [ ] Thread switching works
- [ ] Thread deletion works

### Code Export Testing
- [ ] "View Code" modal opens
- [ ] cURL examples display correctly
- [ ] Python examples display correctly
- [ ] Copy-to-clipboard works

## Security Verification

- [ ] No `NEXT_PUBLIC_` prefix on sensitive variables
- [ ] Service Principal credentials not exposed in client-side code
- [ ] Bearer tokens not visible in browser DevTools
- [ ] API keys not in client-side JavaScript
- [ ] `.env.local` not committed to Git
- [ ] `.vercelignore` configured correctly

## Performance & Monitoring

- [ ] Vercel Analytics enabled (optional)
- [ ] Function execution time < 10s (check Logs)
- [ ] Token refresh happens before expiry (check Logs)
- [ ] No rate limiting errors from Azure

## Troubleshooting (if issues)

### 401 Unauthorized
- [ ] Service Principal has correct role assignment
- [ ] Tenant ID, Client ID, Client Secret are correct
- [ ] Foundry endpoint is accessible from Service Principal

### Missing Configuration
- [ ] All required env vars are set
- [ ] Env vars are set for correct environment (Production)
- [ ] Redeployed after adding env vars

### Build Failures
- [ ] `npm run build` works locally
- [ ] All dependencies in `package.json`
- [ ] No TypeScript errors

### Token Refresh Issues
- [ ] Check Function Logs for error messages
- [ ] Verify Service Principal credentials
- [ ] Ensure `@azure/identity` package is installed

## Success Criteria ✅

Your deployment is successful when:

1. ✅ Customers can visit your app without authentication
2. ✅ Agents respond to queries
3. ✅ No console errors or API failures
4. ✅ Bearer tokens refresh automatically (visible in logs)
5. ✅ All features work identically to local development

---

**Deployment Date**: _______________

**Deployed By**: _______________

**Vercel URL**: _______________

**Notes**:
